name: Test this action
on:
  push:
    branches-ignore:
    - v1
    tags-ignore:
    - '*'
    paths-ignore:
    - README.md
jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        os: [ windows-latest ]
        # Use various version syntaxes here for testing
        ruby: [ 2.3, ruby-2.4, 2.5, ruby-2.6.5, 2.7.0 ]
        exclude:
        - os: windows-latest
          ruby: truffleruby
        - os: ubuntu-16.04
          ruby: rubinius
        - os: macos-latest
          ruby: rubinius
        - os: windows-latest
          ruby: rubinius
    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@v2
    - uses: ./
      with:
        ruby-version: ${{ matrix.ruby }}
    - run: ruby --version
    - name: Test
      run: |
        gem install bundler
        bundle config --local path .bundle/gems
        echo after

  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - run: yarn install
    - run: yarn run lint
